pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--enigma
--made with ♥
--by athur, lucas and remy

function _init()
	create_plr()
	init_msg()
end




function _update()
	if not messages[1] then
		plr_movement()
	end
	update_cam_v1()
	update_msg()
end



function _draw()
	cls()
	draw_map()
	draw_plr()
	draw_ui()
	draw_msg()
end
-->8
--player

function create_plr()
	plr={x=3,
	y=3,
	sprite=1,
	chest=0,
	key=0}
end


function draw_plr()
	spr(plr.sprite,plr.x*8,plr.y*8)
end


function plr_movement()
	newx=plr.x
	newy=plr.y
	if (btnp(➡️)) then
	 newx+=1
	 plr.sprite = 1
	 end
	if (btnp(⬅️)) then
	 newx-=1
	 plr.sprite=2
	 end
	if (btnp(⬇️)) newy+=1
	if (btnp(⬆️)) newy-=1
	
	interact(newx,newy)
	
	if not check_flag(0,newx,newy) then
		plr.x=mid(0,newx,127)
		plr.y=mid(0,newy,63)
	end
end


function interact(x,y)
	if check_flag(1,x,y) then
		pick_up_key(x,y)
	elseif check_flag(2,x,y) then
		pick_up_chest(x,y)
	elseif check_flag(3,x,y) then
		open_door(x,y)
	elseif check_flag(4,x,y) then
		open_tree(x,y)
	end
	if x==6 and y==2 then
		create_msg("ada", "bienvenue dans enigma !", 
					"il faut nous aider,\nretrouve ma soeur plus au sud", "elle t'en diras plus")
	elseif x==10 and y==5 then
		create_msg("panneau", "direction:\nla prairie paisible")
	elseif x==12 and y==8 then
		create_msg("panneau", "direction:\nla prairie fleurie")
	elseif x==9 and y==8 then
	 create_msg("lovelace", "mon papi c'est fait enlever\npar des gobelins rouges", "ils l'ont amene\nsur la montagne infernale", "il te faudra traverser toute\nla region d'enigma", "mais avant il faut deja\nque tu quittes cette prairie", "la clef du donjon\nest a cote de la cascade", "tu pourras y trouver\nde quoi traverser la foret", "bonne chance et\nramene moi mon papi")
	elseif x==30 and y==11 then
		create_msg("panneau", "direction:\nle labyrinthe fou")
	end
end
-->8
--map

function draw_map()
	map(0,0,0,0,128,64)
end


function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end


function update_cam_v1()
		zonex = flr(plr.x/32)*32
		zoney = flr(plr.y/32)*32
		camx = mid(zonex,plr.x-7.5,zonex+16)
		camy = mid(zoney,plr.y-7.5,zoney+16)
	
		camera(camx*8+zonex, camy*8+zoney)
end


function next_tile(x,y)
	sprite=mget(x,y)
	mset(x,y,sprite+1)
end


function pick_up_key(x,y)
	next_tile(x,y)
	plr.key+=1
	sfx(0)
end


function pick_up_chest(x,y)
	next_tile(x,y)
	plr.chest+=1
	create_msg("coffre", "vous avez ramasse\nune hache", "faites en bon usage\nelle va bientot se casser")
	sfx(1)
end


function open_door(x,y)
	if (plr.key > 0) then
		next_tile(x,y)
		sfx(2)
		plr.key-=1
	end	
end


function open_tree(x,y)
	if (plr.chest > 0) then
		next_tile(x,y)
		sfx(4)
		plr.chest-=1
	end	
end
-->8
--ui

function draw_ui()
	camera()
	palt(0,false)
	palt(12,true)
	spr(0,2,2)
	print_outline("X"..plr.key,10,2,7)
	spr(16,22,1)
	print_outline("X"..plr.chest,30,2,7)
	palt()
end

function print_outline(text,x,y)
	print(text,x-1,y,0)
	print(text,x+1,y,0)
	print(text,x,y-1,0)
	print(text,x,y+1,0)
	print(text,x,y,7)
end
-->8
--messages

function init_msg()
	messages={}
end

function create_msg(name,...)
	msg_title=name
	messages={...}
end


function update_msg()
	if (btnp(❎)) then
		deli(messages,1)
	end
end


function draw_msg()
	if messages[1] then
		local y = 100
		--title
		rectfill(7,y,11+#msg_title*4,y+7,2)
		print(msg_title,10,y+2,9)
		--message
		rectfill(3,y+8,124,y+24,4)
		rect(3,y+8,124,y+24,2)
		print(messages[1],6,y+11,15)
	end
end
__gfx__
cccccccc8804440440444088333aa333333443333333333333333333333333333b3333333333333333333333333333333333333333bbbb3333bbbb3300000000
cc0ccccc008888400488880033aaaa33334444333bb33333333333333333333333b33333333333333333333333333333333313333b8bbbb33b8bbbb300000000
c0a0000c084471f00f174480aaffffa344ffff4333bb33333333bb333333333333b333333333333333333333333333333331c1333b3bb8133b33b81300000000
0a0aaaa0804ffff00ffff408aaf1f1a344f1f143333b33b3333bb333333333b3333333333333333333373333333a3333333313333b3833133b3bb31300000000
c0a000a00011666666661100aaffffa344ffff4333333b33333b333333333b33333333bb333333333378733333a9a3333333333331bb3b1331bb3b1300000000
cc0ccc0c0011516556151100335575333355753333333b33333333333bb33b3333333bb33339333333373333333a333333333333331111333311113300000000
cccccccc0091919009191900399999933cccccc3333333333333333333bb333333333b3333989333333333333333333333333333333223333332233300000000
cccccccc000100100100010033733733337337333333333333333333333b33333333333333393333333333333333333333333333334442333344423300000000
cccccccc14444441144200013333333333333333333333333333b33333333333333333333333333333333333333333333333333333bbbb3333bbbb3300000000
00000000440505044452000033333a333333333333333bb3333b33333333003333333333333333333333b33333333333333333333bbbaab33bb33bb300000000
0444444094050504955200003aaaa3a3333333333333bb33333b3333333099033333333333333333333b7b3332333333333333333bb3ba133b3bb31300000000
022aa22094444444954200004a444a44444444443b33b333333333333309a9903333a333333333a33333b3332e233333333733333b3b33133b3b3b1300000000
042222404444441444420000444444444444444433b3333333333333309aa890333a333333333a9a3333333332333333337a733331bb3b1331b33b1300000000
044444409444447494420000322222233222222333b333333b33333330989a9033a9a333333333a333133333333333e333373333331111333311113300000000
06666660942444449420000033333333333333333333333333333333308989033a989a333333333331c1333333333e8e33333333333223333332233300000000
0000000042242424420000003333333333333333333333333333333333000033a98889a33333333333133333333333e333333333334442333344423300000000
33242233333333339999999911111111444444444ffffff433333333333333333336663333333333333333330000000000000000008888000088880000000000
33424433333333334444444411111111444444444f4f44443333333333333333336055633336663333333333080000800800008008a88a800888888000000000
33422433333333332224422411111111cccccccc4ffffff43933333333333333365a506333605563333333330888888008888880088888800888888000000000
33444233333333334444444411111111111111114f44fff4339a66333333393365059006336500633366633308a88a8008888880000880060008800600000000
33422433333333334224242211111111111111114ffffff436950563663693336550590636555056665006638289982882888828056556560565565600000000
3324443333333333444444441111111111111111444f444460595056006a96360500995665500555055500568029920880222208665555866855558600000000
3342243333333333323b332311111111111111114ffffff405a905055505896050559a5550505050505055000082280000822800665005088650050800000000
34244243333333333433334b11111111111111114444f4f450985505505559a50009895000555005505550050080080000800800008008000080080000000000
00000000dddddddd99999999c1c1c1c167767667333339333336633344444444000000001d1111d1ddddddddddddddddddd66ddddddddddddddddddd00000000
00000000dddddddd44444444c1c1c1c11111111133339333336506332224422222200222111d1111dddddddddddddddddddddddddddddadddddddddd00000000
00000000dddddddd22244224c1c1c1c11111111133398a3336005633442222444420024411111111ddddddddddd66dddddd66ddddaaaadaddddddddd00000000
00000000dddddddd44444444c1c1c1c1111111113339933365055563442aa244442002441d111d11d6d6d6d6dd6556dddddddddd4a444a444444444400000000
00000000dddddddd42242422c1c1c1c111111111333a993365500556442222444422224411111111d6d6d6d6dd6556ddddd66ddd444444444444444400000000
00000000dddddddd44444444c1c1c1c1111111113669963605550056444444444444444411d11111ddddddddddd66dddddddddddd222222dd222222d00000000
00000000dddddddd32333323c1c1c1c11111111160508960505055004444444444444444d111d11dddddddddddddddddddd66ddddddddddddddddddd00000000
00000000dddddddd343333437667777611111111500559a550555005666666666666666611111111dddddddddddddddddddddddddddddddddddddddd00000000
__gff__
0000000101000000000000000001010000090002000000000000000000010100110001010100010101010100000000000100010101010105010100000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
__map__
1d1a0d1e1e0d0e1e0d1e0e0e1d1d1e0d1e0d1d1e1e1b1d0e33333333131e1e0e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1e0d1b161d1d211a1c211b190c081a091c1d0e05091e242434343434211e0e0e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1e1d1d0d0a2104211b21050a1c21160a211c210d0d24232323232107210d080e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0d0e1b210b212121070a090b21090c210b1b211d242323232121210d1d1d0e0e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1e0921161c1a0a161b0b1c191a211c082121210823232321211c211e080a1a0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0a190c09242424081a212221211c0a211a210521232321212121210e0d1b0c0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
242424242323232424242425240519211b24242423232121212121211d1e1e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
232323232121212323232325232424242423232323212121212121210d0d0d0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0e1d1e0d211c2121210321213223232323212121082121212121062121211d0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1d1e2121212121062121212121212121212121211c212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0d0e1d212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1d1e0e212121212121212121212121210721212121210721212121212121320d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0d0e1d0d212121210721212121212121212121212121212121212121212121202121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1d070a1d0d21212121212121212121212121212121212121212121212121211d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121210c0d21212121212121212121212121212121212121212121212121212121212121212121
1e0e1a1d0d2121212121212121211c2121212121212121212121212121211d1e2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121210c0d21212121212121212121212121212121212121212121212121212121212121212121
0e1d1e21210721212121212121212121212121072121212121212121211e1d0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
0e1e212121212121212121212121082121212121212121211c212121211d0e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
1d0e1e0821212121212121212121212121212121212121212121211d0d0e1e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
39393939393939393939391139393939393939392121212121210d0d1d080e1d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313c3131392121212121211d0e1b0b1a0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313c3131392121212121210d0e1d1a1c1d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313c313139212121212121211d0d1e1d0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313c313139212121212121210d0e0e1e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393a3a3a3b3a3a3a3a3a3a3b3a3a3a3a3b3a3a393921212121210821211e0e1d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313c3131313921212121212121210e0e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313939393139393939210821212121210d0e0e1d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313931313c313131392121212121211e0d1d0e1e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393d31313c3131313131313c31393a3a3b3a3a3a39212121212121211e1e0d1d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
393939393939393131313939393931313c313137392121212121210e0e1d0e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
21212121172139393939392108393939393939393921212121210d1e0e1e0e0d2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
21082121212121212121211721212121210821212121211721210e1e1d1d0d1e2121212121212121212121212121212121212121212121212121212121210d2121212121212121212121212121212121212121212121212121212121210d21212121212121212121212121212121212121212121212121212121212121212121
26352928272928272928292a282927352a2936272629362a26283635272a260d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d
__sfx__
000200000f04010040110402f000310003300035000130001e0501f05020050290002d0002f0001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200000d3300d3300c3300830001300013000130001300003000230002300023000230003300043300433003330023303c300353002e300273000030007300073000630003300033000f3000c3000830000000
000800000333004330043300000000000000000000002300003000030000000000000130001300013000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00010000006001d6301e6301e6301d6301a6301363000600006000060000600006000563002630016300060000600006000060000600006000060000600006000060005630026300263000600006000060000600
000100000050025630216301b630186300050000500005000050000500005000050000500005003560036600376003960000500005001b6001b6001a600176000050000500005002c6302f630326303063000500
