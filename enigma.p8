pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--enigma
--made with ♥
--by athur, lucas and remy

function _init()
	create_plr()
	init_msg()
	state=0
end


function _update60()
	if (state==0) update_game()
	if (state==1) update_over()
end


function update_game()
	if not messages[1] then
		update_plr()
	end
	update_cam_v1()
	update_msg()
end



function _draw()
	if (state==0) draw_game()
	if (state==1) draw_over()
end


function draw_game()
	cls()
	draw_map()
	draw_plr()
	draw_ui()
	draw_msg()
end
-->8
--player

function create_plr()
	plr={x=3,
	y=3,
	sprite=1,
	chest=0,
	key=0}
end


function draw_plr()
	spr(plr.sprite,plr.x*8,plr.y*8)
end


function update_plr()
	newx=plr.x
	newy=plr.y
	if (btnp(➡️)) then
	 newx+=1
	 plr.sprite = 1
	 end
	if (btnp(⬅️)) then
	 newx-=1
	 plr.sprite=2
	 end
	if (btnp(⬇️)) newy+=1
	if (btnp(⬆️)) newy-=1
	if (btnp(❎)) shoot()
	
	interact(newx,newy)

	if not check_flag(0,newx,newy) then
		plr.x=mid(0,newx,127)
		plr.y=mid(0,newy,63)
	end
end


function interact(x,y)
	if check_flag(1,x,y) then
		pick_up_key(x,y)
	elseif check_flag(2,x,y) then
		pick_up_chest(x,y)
	elseif check_flag(3,x,y) then
		open_door(x,y)
	elseif check_flag(4,x,y) then
		open_tree(x,y)
	end
	if x==6 and y==2 then
		create_msg("ada", "bienvenue dans enigma !", 
				"il faut nous aider,\nretrouve ma soeur plus au sud", "elle t'en diras plus")
	elseif x==10 and y==5 then
		create_msg("panneau", "direction ⬇️ :\nla prairie paisible")
	elseif x==12 and y==8 then
		create_msg("panneau", "direction ⬆️ :\nla prairie fleurie")
	elseif x==9 and y==9 then
		create_msg("lovelace", "mon papi c'est fait enlever\npar des gobelins rouges", "ils l'ont amene\nsur la montagne infernale", "il te faudra traverser toute\nla region d'enigma", "mais avant il faut deja\nque tu quittes cette prairie", "la clef du donjon\nest a cote de la cascade", "tu pourras y trouver\nde quoi traverser la foret", "bonne chance et\nramene moi mon papi")
	elseif x==30 and y==11 then
		create_msg("panneau", "direction ➡️ :\nle labyrinthe fou")
	end
end
-->8
--map

function draw_map()
	map(0,0,0,0,128,64)
end


function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end


function update_cam_v1()
		zonex = flr(plr.x/32)*32
		zoney = flr(plr.y/32)*32
		camx = mid(zonex,plr.x-7.5,zonex+16)
		camy = mid(zoney,plr.y-7.5,zoney+16)
	
		camera(camx*8+zonex, camy*8+zoney)
end


function next_tile(x,y)
	sprite=mget(x,y)
	mset(x,y,sprite+1)
end


function pick_up_key(x,y)
	next_tile(x,y)
	plr.key+=1
	sfx(0)
end


function pick_up_chest(x,y)
	next_tile(x,y)
	plr.chest+=1
	create_msg("coffre", "vous avez ramasse\nune hache", "faites en bon usage\nelle va bientot se casser")
	sfx(1)
end


function open_door(x,y)
	if (plr.key > 0) then
		next_tile(x,y)
		sfx(2)
		plr.key-=1
	end	
end


function open_tree(x,y)
	if (plr.chest > 0) then
		next_tile(x,y)
		sfx(4)
		plr.chest-=1
		create_msg("tronc","votre hache c'est cassee")
	end	
end
-->8
--ui

function draw_ui()
	camera()
	palt(0,false)
	palt(12,true)
	spr(0,2,2)
	print_outline("X"..plr.key,10,2,7)
	spr(16,22,1)
	print_outline("X"..plr.chest,30,2,7)
	palt()
end

function print_outline(text,x,y)
	print(text,x-1,y,0)
	print(text,x+1,y,0)
	print(text,x,y-1,0)
	print(text,x,y+1,0)
	print(text,x,y,7)
end
-->8
--messages

function init_msg()
	messages={}
end

function create_msg(name,...)
	msg_title=name
	messages={...}
end


function update_msg()
	if (btnp(🅾️)) then
		deli(messages,1)
	end
end


function draw_msg()
	if messages[1] then
		local y = 100
		--title
		rectfill(7,y,11+#msg_title*4,y+7,2)
		print(msg_title,10,y+2,9)
		--message
		rectfill(3,y+8,124,y+24,4)
		rect(3,y+8,124,y+24,2)
		print(messages[1],6,y+11,15)	
	end
end
-->8
--bullets


-->8
--game over

function update_over()
	if (btn(🅾️)) _init()
end

function draw_over()
	cls()
	rect(20, 35, 115, 70, 1)
	print("game over 🐱", 45, 40, 8)          
	print("bien joue", 25, 50, 10)
	print("press 🅾️/c to continue", 25, 58, 7) 
end



__gfx__
cccccccc8804440440444088333aa333333443333333333333333333333333333b3333333333333333333333333333333333333333bbbb3333bbbb3300000000
cc0ccccc008888400488880033aaaa33334444333bb33333333333333333333333b33333333333333333333333333333333313333b8bbbb33b8bbbb300000000
c0a0000c084471f00f174480aaffffa344ffff4333bb33333333bb333333333333b333333333333333333333333333333331c1333b3bb8133b33b81300000000
0a0aaaa0804ffff00ffff408aaf1f1a344f1f143333b33b3333bb333333333b3333333333333333333373333333a3333333313333b3833133b3bb31300000000
c0a000a00011666666661100aaffffa344ffff4333333b33333b333333333b33333333bb333333333378733333a9a3333333333331bb3b1331bb3b1300000000
cc0ccc0c0011516556151100335575333355753333333b33333333333bb33b3333333bb33339333333373333333a333333333333331111333311113300000000
cccccccc0091919009191900399999933cccccc3333333333333333333bb333333333b3333989333333333333333333333333333333223333332233300000000
cccccccc000100100100010033733733337337333333333333333333333b33333333333333393333333333333333333333333333334442333344423300000000
cccccccc14444441144200013333333333333333333333333333b33333333333333333333333333333333333333333333333333333bbbb3333bbbb3300000000
00000000440505044452000033333a333333333333333bb3333b33333333003333333333333333333333b33333333333333333333bbbaab33bb33bb300000000
0444444094050504955200003aaaa3a3333333333333bb33333b3333333099033333333333333333333b7b3332333333333333333bb3ba133b3bb31300000000
022aa22094444444954200004a444a44444444443b33b333333333333309a9903333a333333333a33333b3332e233333333733333b3b33133b3b3b1300000000
042222404444441444420000444444444444444433b3333333333333309aa890333a333333333a9a3333333332333333337a733331bb3b1331b33b1300000000
044444409444447494420000322222233222222333b333333b33333330989a9033a9a333333333a333133333333333e333373333331111333311113300000000
06666660942444449420000033333333333333333333333333333333308989033a989a333333333331c1333333333e8e33333333333223333332233300000000
0000000042242424420000003333333333333333333333333333333333000033a98889a33333333333133333333333e333333333334442333344423300000000
33242233333333339999999911111111444444444ffffff433333333333333333336663333366333333333330000000000000000008888000088880000000000
33424433333333334444444411111111444444444f4f44443333333333333333336055633365063333333333080000800800008008a88a800888888000000000
33422433333333332224422411111111cccccccc4ffffff43393333333333333365a506336005633333333330888888008888880088888800888888000000000
33444233333333334444444411111111111111114f44fff4339a66333333393365059006650555633366633308a88a8008888880000880060008800600000000
33422433333333334224242211111111111111114ffffff436950563663693336550590665500556665006638289982882888828056556560565565600000000
3324443333333333444444441111111111111111444f444460595056006a96360500995605550056055500568029920880222208665555866855558600000000
3342243333333333323b332311111111111111114ffffff405a905055505896050559a5550505500505055000082280000822800665005088650050800000000
34244243333333333433334b11111111111111114444f4f450985505505559a50009895050555005505550050080080000800800008008000080080000000000
00000000dddddddd99999999c1c1c1c167767667000000000000000044444444000000001d1111d1ddddddddddddddddddd66ddddddddddddddddddd00000000
00000000dddddddd44444444c1c1c1c11111111100000000000000002224422222200222111d1111dddddddddddddddddddddddddddddadddddddddd00000000
00000000dddddddd22244224c1c1c1c1111111110000000000000000442222444420024411111111ddddddddddd66dddddd66ddddaaaadaddddddddd00000000
00000000dddddddd44444444c1c1c1c1111111110000000000000000442aa244442002441d111d11d6d6d6d6dd6556dddddddddd4a444a444444444400000000
000999a0dddddddd42242422c1c1c1c1111111110000000000000000442222444422224411111111d6d6d6d6dd6556ddddd66ddd444444444444444400000000
00000000dddddddd44444444c1c1c1c1111111110000000000000000444444444444444411d11111ddddddddddd66dddddddddddd222222dd222222d00000000
00000000dddddddd32333323c1c1c1c11111111100000000000000004444444444444444d111d11dddddddddddddddddddd66ddddddddddddddddddd00000000
00000000dddddddd3433334376677776111111110000000000000000666666666666666611111111dddddddddddddddddddddddddddddddddddddddd00000000
00000000004444000044490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005446000045440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694400006944004469445544694455000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694600006946006669466466694664000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400004444004444444944444449000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00445500004455009944554499445544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00664400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000544600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694455446944004469445500694400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694664666946006669466400694600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444449444444004444444900444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00445544994455009944554400445500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000044940000664400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000046440000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444900004449000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00454400004544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694455446944000044544444944400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00694664666946000094444646664500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444449444444000096494444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00445544994455000046444444496400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444400004644000044540000454400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00544400004644000044940000459900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555550046540000644400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665555555550046640000645500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56066065555555d50044449444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5dddddd5555555550059466644469400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55d00d5555d055550054444494449400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50dddd05555555550046449464544400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50000005555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000101000000000000000001010001090002000000000000000000010100110001010100010101010102080000000000010101000005000100000002000001010101000000000000000000000000010101010000000000000000000000000101010100000000000000000000000000000101000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0d1d1e1d1d1e0d0e1e1d0d1e1e0e1e0d1e0e1d0d1e1d0d1e1e33333333131b1d0e6243434343435243434343434352434343434343434343435243434343436321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0d1e0d090d0d1e19091b210c210a09211a211b091e0d0e1d1e343434340d1c1e1d5370717171705370717171717053707170504343637170715371717171705321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1d1e0c161b210421211609211a212116211b21160b0c210d1d2323232307211e1e5371504343437371504343434373714071717170537140715371504343434263212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0d0d1919212121210c21210a21191c211a210b0a09211a210e2323231e210e1d0e5370717171717170717170717171706043525171537153715370717171717153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1e1d0a1a16210a19210a212109161a21190a21212115211e2423231e0d0b211d1d5371624343434343436371624343437370537071537153716043434343517153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1e1d0d1b211c09211a212221211b0a210921161a211c09242323231d1a1d070e0e537153767778797a585371537071717171726371417153715370717171717053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0d1d082424241b0a24242425242424242424210b0a1b242323230d1d1e0d211d1e5371536664656621685370537162436371705370717053717243434343517153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1d2424232323242423232325232323232323242424242323232121212121210d1d4170412121212121217243737041217263717243434361707171717171717053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
2423230d1e23232323232121322121212323232323232323212107210d1d1e1e080d76762121212121212121217666212153707171717072434343434343435273212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
23231d21212115212103212121210821212121212121212121212121210d0e070e1e21212121212121212121212121216242434343637170717171717170715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0d1d0e21212121212121212121212121212121072121212106212121210d1e0d1e6465212166662121212121212121215370717171537162434343435171624263212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1e1e2121212121212121212106212121212121212121212121212121211d320e212121212121212121212121565758217263714070537153717171717170537053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0e21212107212121162121212121212121212121212121212121212121212120212121212121212121212121212121212153716043737153707171716243737153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1d16212121212121212121212108212121212121212121211621212121210d1e212121212121212121212121767721217a53715371717172434343437370717153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0e0d2121212121212121212121212121212121210621212121212121210d1e1d1e0d21212121212121212121212121212153715370407171717171717171624361212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0d1e1d21212121212121062121212121162121212121212121212121211d1e0e1d1d21212121212121212121212121212153707243617062436370407062737053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1d1b0d072121212121212121212121212121212121212121212121210e1e070e1a1e1d212121212121212121212121212153717171724373706043617153717153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
1e1a080d2121210721212121212121212121212121212121212121070d1d1c1a091e0d212121212121212121212121212160435170717071715370537153706273212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
0e1d1d0e2121212121212107212121212121210721212121212121210d1e0b1c190d1e212121212121216821452147212153717171714071715371537153715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393939393939212121212121212121212139393939393921062121211e1e0d1a0d1d1d212121212121212121212121212153705043434251715371537141715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393131313c39393939212121212139393939313c31313921212121210d0d1d1e1e0d68212121212121216864212121216953717170717171704171537170715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393a3a3a3b3a3a3a393939113939393a3a3a3a3b3a3a392121212121210d1d1d0d6821212176212179624343434343434342434343434351717170724351705321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313131313c313139212107212121210d0e1d2121682121662168537071717171717171717170717171704071717170715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313131313c313139212121212121210e1e1e0d21687421762178537150434343434343434352434343434343434351715321212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313131313c313139212121052106210e1e1d1d21212121212121537071717171717171717053717071717171717170717263212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393939393b3a3a3a3a3a3a3b3a3a3a3a3a3a3a3b3a3a393939212121211e1d0e1d1e21212121212162426370504343434343637153716243524351706251717053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393131313c3131313131313c313131313131313c3131393739062121211d080d624343434343524361715371717171717170537153715370537171715370715061212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
39313131393131313131313c313131313131313c313139313921211e1e0d1e1d537171717170537053715370504352434343737153706043617062434263717053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
393d3131393939393931313c313131313131313c3131113139211d1e060c1d0d537140714071537141717243434361707171717072436170417153717053715061212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
39393939392121053939393939393939393939393939393939051d1d1c1b081d537153705371537171707171717041714071407171705371717153716253717053212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
06172121212121212106212117212121210521211721212121210d1e1d1e0e1e5370533d5371724343434343517171715371604343437371504361717242517153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
2726282a272a2a2826292a272a282a262a27292a262a28292a2628272a292a28724342436171717171717171717162436171537071717171717053707171717153212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121
__sfx__
00030000207402574026740227402870025700157001f7001c7001570014700127000170000700007003e7001570000700227001a7002e7003170022700337003070000700257000070000700007000070000700
000400001a1501b1501a1501a150191501a1501a1501c1501e1501e1501e100000000f00000000280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200000020014250152501525012250122500020000200002000020000200002000020000200002000020000200002000020000200002000020000200002000020000200002000020000200002000020000200
